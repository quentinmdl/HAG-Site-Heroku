{% extends 'base.html.twig' %}

{% block body %}
    <container class="session">
        <div class="justify-content-md-center" style="padding: 70px 0;">
            <div class="col-xs-12 col-md-9 mx-auto">
                <div class="text-center">
                    <h2>{{session.name}}</h2>
                    <img  src="{{ vich_uploader_asset(session, 'imageFile') }}"  width="250" height="auto" alt="image de la session">
                    <p>Description{{session.description|raw}}</p>
                    <p>Date de début le {{session.startDate| date('d/m/Y')}} à {{ session.startDate | date('H:i') }}</p>
                    <p>Prend fin le {{session.endDate| date('d/m/Y')}} à {{ session.endDate | date('H:i') }}</p>
                    {% if app.user %}
                        <button id="checkout-button" class="btn btn-primary">Participer</button>
                    {% else %}
                        <p>Veuillez vous connecter afin de pouvoir participer à la session</p>
                        <a href="{{ path('app_login') }}" class="btn btn-primary">Connexion</a> 
                    {% endif %}
                </div>
            </div>
        </div>
    </container>

{% endblock %}

{% block javascripts %}
    <script type="text/javascript">
    // Create an instance of the Stripe object with your publishable API key
    var stripe = Stripe('pk_test_51Ihi1LDDEk7YAvTOmOjvgXhizEs113FDWcbx0AcvWtg7WSXRnvFAozxLjeAqSoPG4YFgUwwAGnkxeahs7Twe8qOU00a75TbayW');
    var checkoutButton = document.getElementById('checkout-button');

    checkoutButton.addEventListener('click', function() {
    // Create a new Checkout Session using the server-side endpoint you
    // created in step 3.
    fetch('/session-participer', {
        method: 'POST',
    })
    .then(function(response) {
        return response.json();
    })
    .then(function(session) {
        return stripe.redirectToCheckout({ sessionId: session.id });
    })
    .then(function(result) {
        // If `redirectToCheckout` fails due to a browser or network
        // error, you should display the localized error message to your
        // customer using `error.message`.
        if (result.error) {
            alert(result.error.message);
        }
    })
    .catch(function(error) {
        console.error('Error:', error);
        });
    });
</script>
{% endblock %}

